# Research PostgreSQL / Trino

Исследовались варианты таблицы `bonus_registry` в PostgreSQL при доступе напрямую (postgres) и через Trino (trino).

**Типы таблиц:**
- **plain** — простая таблица без индекса и партиционирования
- **idx** — таблица с индексом по столбцу accountedForBsProfileId
- **part** — таблица с партиционированием по столбцу accountedForBsProfileId
- **idx_part** — таблица с партиционированием и индексом

**Сценарий:** заполнение таблицы батчами до 50 млн строк → замеры → заполнение до 100 млн → замеры → тесты K6 (конкурентная вставка одной записи). Для таблицы **plain** тесты через Trino не проводились.

---

## 1. Результаты bench:full (логи)

Объёмы в отчёте приведены к **50 млн** и **100 млн** строк по раундам.

### 1.1. plain, mode=postgres

| Параметр | Раунд 1 (50 млн) | Раунд 2 (100 млн) |
|----------|-------------------|-------------------|
| Индекс (мс) | — | — |
| ANALYZE (мс) | 5434 | 6324 |
| Read benchmark: Min (мс) | 2650.04 | 77440.58 |
| Read benchmark: Max (мс) | 35427.16 | 82365.37 |
| Read benchmark: Avg (мс) | 3989.33 | 77584.77 |
| Read benchmark: Median (мс) | 2911.02 | 77494.60 |
| Preparation total (мс) | 112246 | 564133 |

**Запросы (мс), раунд 1 (50 млн):**

| № | Запрос | Min | Max | Avg | Median |
|---|--------|-----|-----|-----|--------|
| 1 | Списания по документу | 3437.51 | 7795.53 | 4324.92 | 3452.70 |
| 2 | Пагинация по профилю | 2260.71 | 2327.41 | 2287.48 | 2278.51 |
| 3 | Записи по профилю без отменённых | 3218.54 | 3265.55 | 3236.34 | 3232.80 |
| 4 | Записи по bs_profile_id | 3236.37 | 3307.29 | 3256.35 | 3247.75 |
| 5 | Профиль + тип бонуса | 3259.69 | 3294.42 | 3278.89 | 3277.64 |
| 6 | Действующие по дате | 2742.80 | 5675.84 | 3741.75 | 3573.09 |
| 7 | GROUP BY bs_quota_id | 3241.35 | 10644.81 | 5330.70 | 4444.75 |
| 8 | По документу (registrar) | 2097.74 | 2148.72 | 2121.42 | 2120.63 |
| 9 | Общая пагинация | 2218.66 | 2327.83 | 2254.45 | 2240.91 |
| 10 | По id | 2.12 | 30.86 | 8.08 | 2.22 |

**Запросы (мс), раунд 2 (100 млн):**

| № | Запрос | Min | Max | Avg | Median |
|---|--------|-----|-----|-----|--------|
| 1 | Списания по документу | 77979.19 | 78142.16 | 78023.62 | 77998.48 |
| 2 | Пагинация по профилю | 77500.26 | 77550.38 | 77525.62 | 77524.15 |
| 3 | Записи по профилю без отменённых | 77786.87 | 77825.11 | 77804.23 | 77802.64 |
| 4 | Записи по bs_profile_id | 77788.73 | 77817.05 | 77801.76 | 77798.84 |
| 5 | Профиль + тип бонуса | 77789.47 | 77818.45 | 77802.00 | 77797.63 |
| 6 | Действующие по дате | 77639.08 | 77665.53 | 77655.95 | 77657.25 |
| 7 | GROUP BY bs_quota_id | 77881.20 | 77929.06 | 77908.86 | 77908.10 |
| 8 | По документу (registrar) | 77307.79 | 77455.34 | 77347.32 | 77321.54 |
| 9 | Общая пагинация | 77428.11 | 77459.68 | 77438.94 | 77435.15 |
| 10 | По id | 1.97 | 33.37 | 8.56 | 2.13 |

---

### 1.2. idx, mode=postgres

| Параметр | Раунд 1 (50 млн) | Раунд 2 (100 млн) |
|----------|-------------------|-------------------|
| Индекс (мс) | 231146 | 447790 |
| ANALYZE (мс) | 3726 | 4531 |
| Read benchmark: Min (мс) | 0.66 | 1.31 |
| Read benchmark: Max (мс) | 10.71 | 9.78 |
| Read benchmark: Avg (мс) | 1.69 | 1.84 |
| Read benchmark: Median (мс) | 1.54 | 1.78 |
| Preparation total (мс) | 45796 | 283449 |

**Запросы (мс), раунд 1 (50 млн):**

| № | Запрос | Min | Max | Avg | Median |
|---|--------|-----|-----|-----|--------|
| 1 | Списания по документу | 1.41 | 52.82 | 11.85 | 1.63 |
| 2 | Пагинация по профилю | 0.78 | 3.54 | 1.51 | 0.80 |
| 3 | Записи по профилю без отменённых | 0.68 | 0.76 | 0.71 | 0.69 |
| 4 | Записи по bs_profile_id | 3200.76 | 13671.48 | 5338.28 | 3265.16 |
| 5 | Профиль + тип бонуса | 0.65 | 1.02 | 0.76 | 0.70 |
| 6 | Действующие по дате | 0.67 | 0.74 | 0.70 | 0.69 |
| 7 | GROUP BY bs_quota_id | 3254.91 | 3424.14 | 3323.64 | 3277.60 |
| 8 | По документу (registrar) | 2082.39 | 2135.03 | 2110.54 | 2100.23 |
| 9 | Общая пагинация | 2196.00 | 2347.29 | 2275.80 | 2302.59 |
| 10 | По id | 2.02 | 31.25 | 7.91 | 2.07 |

**Запросы (мс), раунд 2 (100 млн):**

| № | Запрос | Min | Max | Avg | Median |
|---|--------|-----|-----|-----|--------|
| 1 | Списания по документу | 1.62 | 22.82 | 6.10 | 2.11 |
| 2 | Пагинация по профилю | 0.82 | 7.63 | 2.33 | 1.07 |
| 3 | Записи по профилю без отменённых | 0.80 | 1.03 | 0.87 | 0.83 |
| 4 | Записи по bs_profile_id | 77727.26 | 77855.01 | 77774.53 | 77765.63 |
| 5 | Профиль + тип бонуса | 0.74 | 1.22 | 0.88 | 0.77 |
| 6 | Действующие по дате | 0.70 | 0.79 | 0.75 | 0.75 |
| 7 | GROUP BY bs_quota_id | 77770.19 | 77861.54 | 77810.02 | 77801.33 |
| 8 | По документу (registrar) | 77162.52 | 77247.18 | 77206.73 | 77208.75 |
| 9 | Общая пагинация | 77332.67 | 77357.26 | 77348.41 | 77352.72 |
| 10 | По id | 1.96 | 31.33 | 8.07 | 2.16 |

---

### 1.3. part, mode=postgres

| Параметр | Раунд 1 (50 млн) | Раунд 2 (100 млн) |
|----------|-------------------|-------------------|
| Индекс (мс) | — | — |
| ANALYZE (мс) | 189557 | 252265 |
| Read benchmark: Min (мс) | 1.17 | 2.25 |
| Read benchmark: Max (мс) | 64.91 | 5682.42 |
| Read benchmark: Avg (мс) | 30.67 | 113.79 |
| Read benchmark: Median (мс) | 29.43 | 52.59 |
| Preparation total (мс) | 387211 | 713183 |

**Запросы (мс), раунд 1 (50 млн):**

| № | Запрос | Min | Max | Avg | Median |
|---|--------|-----|-----|-----|--------|
| 1 | Списания по документу | 61.84 | 3952.01 | 840.48 | 62.78 |
| 2 | Пагинация по профилю | 3961.04 | 4026.45 | 3998.45 | 4007.13 |
| 3 | Записи по профилю без отменённых | 61.75 | 64.16 | 63.31 | 63.57 |
| 4 | Записи по bs_profile_id | 51839.04 | 52276.92 | 51993.09 | 51920.95 |
| 5 | Профиль + тип бонуса | 3696.63 | 3921.56 | 3839.90 | 3856.90 |
| 6 | Действующие по дате | 61.83 | 4145.95 | 2460.34 | 3996.31 |
| 7 | GROUP BY bs_quota_id | 56826.08 | 57340.25 | 57112.13 | 57112.94 |
| 8 | По документу (registrar) | 47830.13 | 48147.94 | 47925.89 | 47897.29 |
| 9 | Общая пагинация | 46643.07 | 46861.82 | 46748.64 | 46760.59 |
| 10 | По id | 6.01 | 94.55 | 23.95 | 6.32 |

**Запросы (мс), раунд 2 (100 млн):**

| № | Запрос | Min | Max | Avg | Median |
|---|--------|-----|-----|-----|--------|
| 1 | Списания по документу | 110.20 | 6593.40 | 1407.26 | 111.13 |
| 2 | Пагинация по профилю | 7203.59 | 7426.13 | 7280.16 | 7253.91 |
| 3 | Записи по профилю без отменённых | 110.76 | 111.63 | 111.30 | 111.38 |
| 4 | Записи по bs_profile_id | 98171.74 | 98436.66 | 98245.24 | 98199.79 |
| 5 | Профиль + тип бонуса | 7081.02 | 7242.35 | 7166.53 | 7175.92 |
| 6 | Действующие по дате | 112.38 | 7207.13 | 4351.31 | 7159.58 |
| 7 | GROUP BY bs_quota_id | 103372.53 | 103456.86 | 103427.97 | 103445.96 |
| 8 | По документу (registrar) | 94222.51 | 94246.39 | 94233.66 | 94233.32 |
| 9 | Общая пагинация | 92997.13 | 93041.91 | 93022.57 | 93028.49 |
| 10 | По id | 5.75 | 17.17 | 8.15 | 5.93 |

---

### 1.4. idx_part, mode=postgres

| Параметр | Раунд 1 (50 млн) | Раунд 2 (100 млн) |
|----------|-------------------|-------------------|
| Индекс (мс) | 136357 | 288788 |
| ANALYZE (мс) | 126109 | 221815 |
| Read benchmark: Min (мс) | 0.67 | 0.63 |
| Read benchmark: Max (мс) | 9.78 | 7.67 |
| Read benchmark: Avg (мс) | 0.94 | 0.78 |
| Read benchmark: Median (мс) | 0.81 | 0.68 |
| Preparation total (мс) | 165811 | 354479 |

**Запросы (мс), раунд 1 (50 млн):**

| № | Запрос | Min | Max | Avg | Median |
|---|--------|-----|-----|-----|--------|
| 1 | Списания по документу | 1.32 | 49.01 | 11.09 | 1.64 |
| 2 | Пагинация по профилю | 7.96 | 10.78 | 9.67 | 9.92 |
| 3 | Записи по профилю без отменённых | 0.79 | 0.91 | 0.83 | 0.81 |
| 4 | Записи по bs_profile_id | 45106.55 | 45696.15 | 45261.00 | 45149.96 |
| 5 | Профиль + тип бонуса | 1.79 | 2.81 | 2.19 | 1.91 |
| 6 | Действующие по дате | 0.70 | 4.19 | 2.08 | 2.30 |
| 7 | GROUP BY bs_quota_id | 50257.01 | 50451.27 | 50352.08 | 50337.42 |
| 8 | По документу (registrar) | 41160.72 | 41282.13 | 41239.79 | 41254.23 |
| 9 | Общая пагинация | 39913.28 | 40055.24 | 39973.86 | 39977.34 |
| 10 | По id | 5.68 | 29.39 | 10.87 | 6.43 |

**Запросы (мс), раунд 2 (100 млн):**

| № | Запрос | Min | Max | Avg | Median |
|---|--------|-----|-----|-----|--------|
| 1 | Списания по документу | 1.63 | 52.00 | 11.89 | 1.91 |
| 2 | Пагинация по профилю | 13.90 | 15.45 | 14.52 | 14.03 |
| 3 | Записи по профилю без отменённых | 0.79 | 0.91 | 0.85 | 0.84 |
| 4 | Записи по bs_profile_id | 96991.78 | 97341.03 | 97070.55 | 97003.12 |
| 5 | Профиль + тип бонуса | 1.72 | 2.43 | 2.05 | 1.93 |
| 6 | Действующие по дате | 0.72 | 2.92 | 1.95 | 2.31 |
| 7 | GROUP BY bs_quota_id | 102109.90 | 102318.83 | 102174.86 | 102147.51 |
| 8 | По документу (registrar) | 93018.86 | 93066.01 | 93044.91 | 93048.16 |
| 9 | Общая пагинация | 91795.96 | 91890.89 | 91837.16 | 91825.57 |
| 10 | По id | 6.09 | 16.52 | 8.24 | 6.16 |

---

### 1.5. idx, mode=trino

| Параметр | Раунд 1 (50 млн) | Раунд 2 (100 млн) |
|----------|-------------------|-------------------|
| Индекс (мс) | 227031 | 479252 |
| ANALYZE (мс) | 3909 | 4702 |
| Read benchmark: Min (мс) | 68.31 | 63.16 |
| Read benchmark: Max (мс) | 132.26 | 73.98 |
| Read benchmark: Avg (мс) | 74.89 | 66.86 |
| Read benchmark: Median (мс) | 73.37 | 66.30 |
| Preparation total (мс) | — | — |

**Запросы (мс), раунд 1 (50 млн):**

| № | Запрос | Min | Max | Avg | Median |
|---|--------|-----|-----|-----|--------|
| 1 | Списания по документу | 51.68 | 89.07 | 60.61 | 53.10 |
| 2 | Пагинация по профилю | 71.73 | 80.26 | 74.68 | 73.38 |
| 3 | Записи по профилю без отменённых | 68.75 | 73.93 | 70.75 | 70.44 |
| 4 | Записи по bs_profile_id | 14360.98 | 14584.93 | 14443.75 | 14432.87 |
| 5 | Профиль + тип бонуса | 69.85 | 74.62 | 72.04 | 71.12 |
| 6 | Действующие по дате | 67.98 | 72.43 | 69.40 | 68.90 |
| 7 | GROUP BY bs_quota_id | 13929.77 | 14464.87 | 14101.87 | 13964.33 |
| 8 | По документу (registrar) | 7228.95 | 8166.91 | 7469.20 | 7262.17 |
| 9 | Общая пагинация | 10664.37 | 11686.83 | 10942.93 | 10789.26 |
| 10 | По id | 66.37 | 89.76 | 72.20 | 68.32 |

**Запросы (мс), раунд 2 (100 млн):**

| № | Запрос | Min | Max | Avg | Median |
|---|--------|-----|-----|-----|--------|
| 1 | Списания по документу | 45.29 | 53.35 | 48.01 | 47.37 |
| 2 | Пагинация по профилю | 64.23 | 65.20 | 64.67 | 64.72 |
| 3 | Записи по профилю без отменённых | 61.28 | 62.97 | 62.37 | 62.73 |
| 4 | Записи по bs_profile_id | 111972.74 | 120364.90 | 115073.49 | 113945.68 |
| 5 | Профиль + тип бонуса | 63.06 | 75.15 | 67.57 | 65.68 |
| 6 | Действующие по дате | 63.94 | 67.52 | 65.93 | 66.52 |
| 7 | GROUP BY bs_quota_id | 109723.81 | 112207.80 | 111001.09 | 111013.56 |
| 8 | По документу (registrar) | 107847.32 | 109427.73 | 108704.74 | 109017.33 |
| 9 | Общая пагинация | 107869.55 | 108932.05 | 108552.56 | 108711.73 |
| 10 | По id | 63.20 | 104.12 | 71.65 | 63.53 |

---

### 1.6. part, mode=trino

| Параметр | Раунд 1 (50 млн) | Раунд 2 (100 млн) |
|----------|-------------------|-------------------|
| Индекс (мс) | — | — |
| ANALYZE (мс) | 203477 | — |
| Read benchmark: Min (мс) | 66.37 | 75.43 |
| Read benchmark: Max (мс) | 73.56 | 148.72 |
| Read benchmark: Avg (мс) | 69.41 | 82.97 |
| Read benchmark: Median (мс) | 69.39 | 81.40 |
| Preparation total (мс) | — | — |

**Запросы (мс), раунд 1 (50 млн):**

| № | Запрос | Min | Max | Avg | Median |
|---|--------|-----|-----|-----|--------|
| 1 | Списания по документу | 135.72 | 138.12 | 136.76 | 136.73 |
| 2 | Пагинация по профилю | 154.49 | 157.56 | 155.96 | 155.95 |
| 3 | Записи по профилю без отменённых | 152.42 | 153.78 | 153.05 | 153.09 |
| 4 | Записи по bs_profile_id | 75635.31 | 100209.25 | 86372.41 | 84496.09 |
| 5 | Профиль + тип бонуса | 136.17 | 1864.61 | 482.71 | 137.29 |
| 6 | Действующие по дате | 134.87 | 136.78 | 135.98 | 136.10 |
| 7 | GROUP BY bs_quota_id | 78852.90 | 80478.91 | 79414.80 | 79306.37 |
| 8 | По документу (registrar) | 67183.42 | 69148.12 | 67853.82 | 67458.23 |
| 9 | Общая пагинация | 64411.35 | 67266.03 | 66017.91 | 66382.14 |
| 10 | По id | 153.70 | 332.05 | 190.30 | 155.01 |

**Запросы (мс), раунд 2 (100 млн):**

| № | Запрос | Min | Max | Avg | Median |
|---|--------|-----|-----|-----|--------|
| 1 | Списания по документу | 215.05 | 3077.67 | 788.06 | 215.63 |
| 2 | Пагинация по профилю | 231.49 | 233.04 | 232.38 | 232.39 |
| 3 | Записи по профилю без отменённых | 228.63 | 232.37 | 230.69 | 230.44 |
| 4 | Записи по bs_profile_id | 183586.87 | 206672.28 | 190899.85 | 187168.42 |
| 5 | Профиль + тип бонуса | 234.29 | 744.19 | 337.26 | 235.90 |
| 6 | Действующие по дате | 234.00 | 237.55 | 235.58 | 235.11 |
| 7 | GROUP BY bs_quota_id | 186665.38 | 189369.52 | 188055.88 | 187789.34 |
| 8 | По документу (registrar) | 174898.29 | 176093.75 | 175615.40 | 175730.18 |
| 9 | Общая пагинация | 173373.82 | 176097.15 | 174410.88 | 173696.98 |
| 10 | По id | 159.82 | 285.41 | 186.20 | 160.98 |

---

### 1.7. idx_part, mode=trino

| Параметр | Раунд 1 (50 млн) | Раунд 2 (100 млн) |
|----------|-------------------|-------------------|
| Индекс (мс) | 139149 | 835366 |
| ANALYZE (мс) | 141468 | 394121 |
| Read benchmark: Min (мс) | 67.30 | 88.23 |
| Read benchmark: Max (мс) | 85.04 | 306.63 |
| Read benchmark: Avg (мс) | 71.57 | 101.10 |
| Read benchmark: Median (мс) | 71.18 | 97.39 |
| Preparation total (мс) | — | — |

**Запросы (мс), раунд 1 (50 млн):**

| № | Запрос | Min | Max | Avg | Median |
|---|--------|-----|-----|-----|--------|
| 1 | Списания по документу | 50.13 | 53.07 | 51.18 | 50.84 |
| 2 | Пагинация по профилю | 69.61 | 71.69 | 70.35 | 69.91 |
| 3 | Записи по профилю без отменённых | 68.09 | 69.12 | 68.58 | 68.62 |
| 4 | Записи по bs_profile_id | 58988.12 | 74975.43 | 64615.33 | 60771.23 |
| 5 | Профиль + тип бонуса | 67.60 | 85.22 | 71.52 | 67.82 |
| 6 | Действующие по дате | 66.91 | 68.63 | 67.57 | 67.60 |
| 7 | GROUP BY bs_quota_id | 66217.55 | 68214.31 | 67192.82 | 67206.47 |
| 8 | По документу (registrar) | 53148.72 | 57876.71 | 54977.24 | 54564.02 |
| 9 | Общая пагинация | 52117.54 | 54077.77 | 53045.06 | 53059.95 |
| 10 | По id | 158.95 | 284.76 | 184.93 | 160.15 |

**Запросы (мс), раунд 2 (100 млн):**

| № | Запрос | Min | Max | Avg | Median |
|---|--------|-----|-----|-----|--------|
| 1 | Списания по документу | 333.95 | 10179.07 | 2365.66 | 343.81 |
| 2 | Пагинация по профилю | 337.87 | 401.62 | 368.92 | 367.04 |
| 3 | Записи по профилю без отменённых | 337.50 | 357.12 | 349.21 | 350.61 |
| 4 | Записи по bs_profile_id | 187742.84 | 222908.06 | 196405.34 | 190230.10 |
| 5 | Профиль + тип бонуса | 310.01 | 4256.04 | 1104.75 | 319.34 |
| 6 | Действующие по дате | 285.88 | 291.99 | 289.67 | 289.77 |
| 7 | GROUP BY bs_quota_id | 223616.63 | 265955.76 | 243800.03 | 246238.73 |
| 8 | По документу (registrar) | 270766.78 | 278038.68 | 274706.14 | 274739.87 |
| 9 | Общая пагинация | 268728.14 | 278897.30 | 274540.16 | 276107.21 |
| 10 | По id | 179.39 | 282.48 | 201.64 | 180.19 |

---

## 2. Результаты K6 (insert-one)

Тест: конкурентная вставка одной записи (200 VUs). Время в мс, если не указано иное.

| Конфигурация | plain (postgres) | idx (postgres) | part (postgres) | idx_part (postgres) | idx (trino) | part (trino) | idx_part (trino) |
|--------------|------------------|----------------|-----------------|---------------------|-------------|--------------|------------------|
| **testRunDurationMs** | 56480.81 | 56650.04 | 56464.15 | 56461.52 | 60165.60 | 57047.95 | 57483.59 |
| **http_reqs count** | 68836 | 68130 | 68820 | 68908 | 42795 | 56639 | 12258 |
| **http_reqs rate** | 1218.75 | 1202.65 | 1218.83 | 1220.44 | 711.29 | 992.83 | 213.24 |
| **http_req_duration avg** | 73.24 | 75.42 | 73.18 | 73.00 | 181.93 | 110.39 | 849.73 |
| **http_req_duration med** | 71.38 | 71.30 | 70.76 | 70.97 | 97.71 | 103.71 | 533.58 |
| **http_req_duration min** | 0.02 | 0.02 | -1079.66 | 0.02 | 0.02 | 0.02 | 0.02 |
| **http_req_duration max** | 502.57 | 562.97 | 484.67 | 446.02 | 17421.57 | 2192.77 | 12949.62 |
| **http_req_duration p(90)** | 79.80 | 80.67 | 77.93 | 78.56 | 122.69 | 124.54 | 1402.99 |
| **http_req_duration p(95)** | 83.32 | 88.67 | 81.02 | 82.04 | 139.15 | 139.45 | 3189.46 |
| **iteration_duration avg** | 174.50 | 176.68 | 174.50 | 174.34 | 280.70 | 212.12 | 989.75 |
| **iteration_duration med** | 172.11 | 172.01 | 171.48 | 171.70 | 198.45 | 204.53 | 641.08 |
| **iteration_duration min** | 162.89 | 163.30 | 162.74 | 163.21 | 139.79 | 163.95 | 205.11 |
| **iteration_duration max** | 687.18 | 663.60 | 686.67 | 707.46 | 17585.24 | 2396.31 | 13147.96 |
| **iteration_duration p(90)** | 180.58 | 181.50 | 178.74 | 179.29 | 223.12 | 225.83 | 1650.46 |
| **iteration_duration p(95)** | 184.06 | 189.79 | 181.80 | 182.78 | 238.25 | 240.32 | 3475.40 |
| **checks passes** | 137672 | 136260 | 137640 | 137816 | 0 | 0 | 56 |
| **checks fails** | 0 | 0 | 0 | 0 | 85590 | 113278 | 24460 |
| **checks rate** | 1 | 1 | 1 | 1 | 0 | 0 | 0.002 |
| **data_sent count** | 40076368 | 39665543 | 40066879 | 40117842 | 24915816 | 32975300 | 7136713 |
| **data_sent rate** | 709557.19 | 700185.63 | 709598.58 | 710534.25 | 414120.60 | 578027.78 | 124152.18 |
| **data_received count** | 19411752 | 19076400 | 19338420 | 19638780 | 13513798 | 17671368 | 6154677 |
| **data_received rate** | 343687.54 | 336741.17 | 342490.25 | 347825.93 | 224610.03 | 309763.42 | 107068.42 |

---

## 3. Сводные сравнения

### 3.1. Read benchmark (Avg, мс) по раундам

| Тип таблицы | postgres 50M | postgres 100M | trino 50M | trino 100M |
|-------------|--------------|---------------|-----------|------------|
| plain | 3989.33 | 77584.77 | — | — |
| idx | 1.69 | 1.84 | 74.89 | 66.86 |
| part | 30.67 | 113.79 | 69.41 | 82.97 |
| idx_part | 0.94 | 0.78 | 71.57 | 101.10 |

### 3.2. Время создания индекса (мс), postgres vs trino

| Тип | postgres 50M | postgres 100M | trino 50M | trino 100M |
|-----|--------------|---------------|-----------|------------|
| idx | 231146 | 447790 | 227031 | 479252 |
| idx_part | 136357 | 288788 | 139149 | 835366 |

### 3.3. K6: throughput (http_reqs rate) и латентность (http_req_duration avg, мс)

| Конфигурация | rate (req/s) | avg (мс) |
|--------------|--------------|----------|
| plain postgres | 1218.75 | 73.24 |
| idx postgres | 1202.65 | 75.42 |
| part postgres | 1218.83 | 73.18 |
| idx_part postgres | 1220.44 | 73.00 |
| idx trino | 711.29 | 181.93 |
| part trino | 992.83 | 110.39 |
| idx_part trino | 213.24 | 849.73 |

Postgres-варианты дают близкий throughput (~1200 req/s) и низкую латентность (~73–75 мс). Trino даёт меньший throughput и большую латентность; idx_part через Trino — наименьший throughput (213 req/s) и наибольшая латентность (850 мс в среднем).

---

## ВАЖНО:
При использовании индекса необходимо заботится о том, чтобы размер таблицы (или таблиц при партиционировании) не превышал определенного значения (в рамках теста это число было в пределах 55 - 65 млн записей, может зависеть от конфигурации postgres). При достижении эого значения построение индекса вызывает очень большую задержку при вставке новой строки в таблицу, поэтому в бенчмарках индекс создавался после заполнения таблицы данными.
